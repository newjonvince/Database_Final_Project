<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>PM - {{ 'Add' if mode=='add' else 'Edit' }} Task</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    label { display:block; margin-top:10px; }
    input, select { width: 460px; padding: 6px; }
    .msg { padding: 10px; margin: 10px 0; border: 1px solid #ddd; }
  </style>
</head>
<body>
<h1>PM: {{ 'Add' if mode=='add' else 'Edit' }} Task</h1>
<p><a href="{{ url_for('pm_tasks_list') }}">‚Üê Back to Tasks</a></p>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="msg">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="post">
  <label>Project</label>
  <select name="project_id" required>
    {% for p in projects %}
      <option value="{{ p.project_id }}"
        {% if task and task.project_id == p.project_id %}selected{% endif %}>
        {{ p.project_code }} - {{ p.project_name }}
      </option>
    {% endfor %}
  </select>

  <label>Task Name</label>
  <input name="task_name" required value="{{ task.task_name if task else '' }}">

  <label>Task Status</label>
  <select name="task_status">
    {% set current = task.task_status if task else 'To Do' %}
    {% for s in ['To Do','In Progress','Blocked','Done','Planning'] %}
      <option value="{{ s }}" {% if current==s %}selected{% endif %}>{{ s }}</option>
    {% endfor %}
  </select>

  <label>Assign Employee (optional)</label>
  <select name="employee_id">
    <option value="">(Unassigned)</option>
    {% for e in employees %}
      <option value="{{ e.employee_id }}"
        {% if task and task.employee_id == e.employee_id %}selected{% endif %}>
        {{ e.employee_number }} - {{ e.last_name }}, {{ e.first_name }}
      </option>
    {% endfor %}
  </select>

  <label>Due Date (optional)</label>
  <input name="due_date" type="date" value="{{ task.due_date if task else '' }}">

  {% if mode=='edit' %}
    <label>Active?</label>
    <select name="is_active">
      <option value="1" {% if task.is_active==1 %}selected{% endif %}>Yes</option>
      <option value="0" {% if task.is_active==0 %}selected{% endif %}>No</option>
    </select>
  {% endif %}

  <div style="margin-top:16px;">
    <button type="submit">{{ 'Create' if mode=='add' else 'Save Changes' }}</button>
  </div>
</form>

</body>
</html>
